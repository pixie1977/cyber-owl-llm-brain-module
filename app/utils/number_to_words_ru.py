"""
–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —á–∏—Å–µ–ª –≤ —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.
"""
from app.core.logger import get_logger

log = get_logger(__name__)

def float_to_text_russian(value: str) -> str:
    """
    –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —á–∏—Å–ª–æ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
    —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –¥–µ—Å—è—Ç–∏—Ç—ã—Å—è—á–Ω—ã—Ö (4 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π).

    –ü—Ä–∏–º–µ—Ä—ã:
        3.1415 ‚Üí "—Ç—Ä–∏ —Ü–µ–ª—ã—Ö –æ–¥–Ω–∞ —Ç—ã—Å—è—á–∞ —á–µ—Ç—ã—Ä–µ—Å—Ç–∞ –ø—è—Ç–Ω–∞–¥—Ü–∞—Ç—å –¥–µ—Å—è—Ç–∏—Ç—ã—Å—è—á–Ω—ã—Ö"
        0.0001 ‚Üí "–æ–¥–Ω–∞ –¥–µ—Å—è—Ç–∏—Ç—ã—Å—è—á–Ω–∞—è"
        2.5    ‚Üí "–¥–≤–µ —Ü–µ–ª—ã—Ö –ø—è—Ç—å —Ç—ã—Å—è—á –¥–µ—Å—è—Ç–∏—Ç—ã—Å—è—á–Ω—ã—Ö"

    Args:
        value: –ß–∏—Å–ª–æ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π.

    Returns:
        –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.
    """
    # –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ 4 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
    try:
        value = round(float(value), 4)
    except ValueError as e:
        log.error(e)
        return "–æ—à–∏–±–∫–∞ —Å–ª—É—á–∏–ª–∞—Å—å"

    # –†–∞–∑–¥–µ–ª—è–µ–º —Ü–µ–ª—É—é –∏ –¥—Ä–æ–±–Ω—É—é —á–∞—Å—Ç–∏
    integer_part = int(abs(value))
    fractional_part = int(round((abs(value) - integer_part) * 10000))  # –¥–æ 4 –∑–Ω–∞–∫–æ–≤

    # –°–ª–æ–≤–∞—Ä–∏ –¥–ª—è —Å–ª–æ–≤
    ones = ["", "–æ–¥–∏–Ω", "–¥–≤–∞", "—Ç—Ä–∏", "—á–µ—Ç—ã—Ä–µ", "–ø—è—Ç—å", "—à–µ—Å—Ç—å", "—Å–µ–º—å", "–≤–æ—Å–µ–º—å", "–¥–µ–≤—è—Ç—å"]
    teens = ["–¥–µ—Å—è—Ç—å", "–æ–¥–∏–Ω–Ω–∞–¥—Ü–∞—Ç—å", "–¥–≤–µ–Ω–∞–¥—Ü–∞—Ç—å", "—Ç—Ä–∏–Ω–∞–¥—Ü–∞—Ç—å", "—á–µ—Ç—ã—Ä–Ω–∞–¥—Ü–∞—Ç—å",
             "–ø—è—Ç–Ω–∞–¥—Ü–∞—Ç—å", "—à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç—å", "—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å", "–≤–æ—Å–µ–º–Ω–∞–¥—Ü–∞—Ç—å", "–¥–µ–≤—è—Ç–Ω–∞–¥—Ü–∞—Ç—å"]
    tens = ["", "", "–¥–≤–∞–¥—Ü–∞—Ç—å", "—Ç—Ä–∏–¥—Ü–∞—Ç—å", "—Å–æ—Ä–æ–∫", "–ø—è—Ç—å–¥–µ—Å—è—Ç",
            "—à–µ—Å—Ç—å–¥–µ—Å—è—Ç", "—Å–µ–º—å–¥–µ—Å—è—Ç", "–≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç", "–¥–µ–≤—è–Ω–æ—Å—Ç–æ"]
    hundreds = ["", "—Å—Ç–æ", "–¥–≤–µ—Å—Ç–∏", "—Ç—Ä–∏—Å—Ç–∞", "—á–µ—Ç—ã—Ä–µ—Å—Ç–∞", "–ø—è—Ç—å—Å–æ—Ç",
                "—à–µ—Å—Ç—å—Å–æ—Ç", "—Å–µ–º—å—Å–æ—Ç", "–≤–æ—Å–µ–º—å—Å–æ—Ç", "–¥–µ–≤—è—Ç—å—Å–æ—Ç"]
    thousands = ["", "–æ–¥–Ω–∞ —Ç—ã—Å—è—á–∞", "–¥–≤–µ —Ç—ã—Å—è—á–∏", "—Ç—Ä–∏ —Ç—ã—Å—è—á–∏", "—á–µ—Ç—ã—Ä–µ —Ç—ã—Å—è—á–∏",
                 "–ø—è—Ç—å —Ç—ã—Å—è—á", "—à–µ—Å—Ç—å —Ç—ã—Å—è—á", "—Å–µ–º—å —Ç—ã—Å—è—á", "–≤–æ—Å–µ–º—å —Ç—ã—Å—è—á", "–¥–µ–≤—è—Ç—å —Ç—ã—Å—è—á"]

    def number_to_words(n: int) -> str:
        if n == 0:
            return ""
        result = []
        t = n // 1000
        h = (n % 1000) // 100
        tn = (n % 100) // 10
        o = n % 10

        if t > 0:
            if t == 1:
                result.append("–æ–¥–Ω–∞ —Ç—ã—Å—è—á–∞")
            elif t == 2:
                result.append("–¥–≤–µ —Ç—ã—Å—è—á–∏")
            else:
                result.append(f"{ones[t]} —Ç—ã—Å—è—á")

        if h > 0:
            result.append(hundreds[h])

        if tn == 1:
            result.append(teens[o])
        else:
            if tn > 0:
                result.append(tens[tn])
            if o > 0:
                result.append(ones[o])

        return " ".join(result).strip()

    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ü–µ–ª—É—é —á–∞—Å—Ç—å
    integer_text = number_to_words(integer_part) or "–Ω–æ–ª—å"

    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–ª—è "—Ü–µ–ª–∞—è/—Ü–µ–ª—ã—Ö"
    last_digit = integer_part % 10
    if integer_part % 100 in range(11, 20):
        integer_unit = "—Ü–µ–ª—ã—Ö"
    elif last_digit == 1:
        integer_unit = "—Ü–µ–ª–∞—è"
    else:
        integer_unit = "—Ü–µ–ª—ã—Ö"

    # –î—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å
    if fractional_part == 0:
        return f"{integer_text} {integer_unit}"

    fractional_text = number_to_words(fractional_part) or ""

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –µ–¥–∏–Ω–∏—Ü—É –∏–∑–º–µ—Ä–µ–Ω–∏—è –¥—Ä–æ–±–Ω–æ–π —á–∞—Å—Ç–∏
    fractional_last_digit = fractional_part % 10
    fractional_teen = fractional_part % 100
    if fractional_teen in range(11, 20) or fractional_last_digit not in [1, 2]:
        fractional_unit = "–¥–µ—Å—è—Ç–∏—Ç—ã—Å—è—á–Ω—ã—Ö"
    elif fractional_last_digit == 1:
        fractional_unit = "–¥–µ—Å—è—Ç–∏—Ç—ã—Å—è—á–Ω–∞—è"
    else:  # == 2
        fractional_unit = "–¥–µ—Å—è—Ç–∏—Ç—ã—Å—è—á–Ω—ã–µ"

    sign = "–º–∏–Ω—É—Å " if value < 0 else ""
    return f"{sign}{integer_text} {integer_unit} {fractional_text} {fractional_unit}"


if __name__ == "__main__":
    # –¢–µ—Å—Ç—ã –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏
    test_cases = [
        3.1415,
        0.0001,
        2.5,
        1.0,
        0.0000,
        -1.2345,
        12.3456,
        0.0010,
        9.9999,
        100.0001
    ]

    print("üß™ –¢–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏ float_to_text_russian:\n")
    for num in test_cases:
        text = float_to_text_russian(num)
        print(f"{num:>10} ‚Üí {text}")